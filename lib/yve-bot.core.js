module.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e){t.exports=require("lodash")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=n(2),o=function(){function t(){}return t.prototype.define=function(t,e){var n=this;if("string"!=typeof t)Object.keys(t).forEach(function(e){n.define(e,t[e])});else{if(t in this)throw new i.RedefineConfigurationError(typeof this,t);this[t]=e}return this},t.prototype.extend=function(t,e,n){var i=this[e];return this.define(t,r.merge({},i,n))},t}();e.DefineModule=o},function(t,e,n){"use strict";function r(t,e){this.key="validator",this.message=t||'Invalid value for "'+e.type+'" type'}function i(t,e){this.key="invalidAttribute",this.message="Invalid "+t+' attribute "'+e.type+'"'}function o(t,e){this.key="redefineConfiguration",this.message="You can't redefine the \""+e+'" in '+t+"."}function s(t,e){this.key="ruleNotFound",this.message='Rule "'+t+'" not found in indexes',this.indexes=e}Object.defineProperty(e,"__esModule",{value:!0}),e.ValidatorError=r,e.InvalidAttributeError=i,e.RedefineConfigurationError=o,e.RuleNotFound=s},function(t,e,n){"use strict";function r(t,e){return t.replace(/{(.*?)}/g,function(t,n){for(var r=e,i=0,o=n.split(".");i<o.length;i++){r=r[o[i]]}return r||""})}function i(t){return 40*(t||"").length}function o(t,e){var n=String(e).toLowerCase();return String(t).toLowerCase()===n}function s(t,e){var n=u(e);return t.filter(function(t){return n.some(function(e){return o(e,t.value)})||n.some(function(e){return o(e,t.label)})})[0]}function u(t){return t instanceof Array?t:[t]}function a(t,e){return e.filter(function(e){return t.toLowerCase().indexOf(e.toLowerCase())>=0})}Object.defineProperty(e,"__esModule",{value:!0}),e.compileTemplate=r,e.calculateDelayToTypeMessage=i,e.isMatchAnswer=o,e.findOptionByAnswer=s,e.ensureArray=u,e.identifyAnswersInString=a},function(t,e,n){"use strict";var r=n(5);t.exports=r.YveBot},function(t,e,n){"use strict";function r(t){return"string"==typeof t?{message:t}:(["SingleChoice","MultipleChoice"].indexOf(t.type)>=0&&(t.options=(t.options||[]).map(function(t){return"string"==typeof t?{value:t}:t})),t)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),o=n(7),s=n(8),u=n(9),a=n(10),c=function(){function t(t,e){var n={enableWaitForSleep:!0};this.sessionId="session",this.options=Object.assign({},n,e),this.rules=t.map(function(t){return r(t)}),this.handlers={},this.store=new i.Store(this),this.controller=new o.Controller(this),this.on("error",function(t){throw t})}return t.prototype.on=function(t,e){return!(["error"].indexOf(t)>=0)&&t in this.handlers?this.handlers[t].push(e):this.handlers[t]=[e],this},t.prototype.start=function(){return this.dispatch("start"),this.controller.run().catch(this.tryCatch.bind(this)),this},t.prototype.end=function(){return this.dispatch("end",this.store.output()),this},t.prototype.talk=function(t,e){var n=Object.assign({},this.options.rule,e||{});return this.controller.sendMessage(t,n),this},t.prototype.hear=function(t){return this.controller.receiveMessage(t).catch(this.tryCatch.bind(this)),this},t.prototype.dispatch=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];t in this.handlers&&this.handlers[t].forEach(function(t){return t.apply(void 0,n.concat([e.sessionId]))})},t.prototype.session=function(t,e){return void 0===e&&(e={}),this.sessionId=t,e.rules?(this._rules=this.rules,this.rules=e.rules.map(function(t){return r(t)})):this.rules=this._rules||this.rules,e.store?this.store.replace(e.store):(this.store.reset(),this.controller.reindex()),this},t.prototype.tryCatch=function(t){this.dispatch("error",t),this.end()},t}();e.YveBot=c,c.prototype.types=new u.Types,c.prototype.actions=new s.Actions,c.prototype.validators=new a.Validators},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=function(){function t(t){this.bot=t,this.reset()}return t.prototype.output=function(){var t=this.get("output");return Object.assign({},t)},t.prototype.set=function(t,e){this.data=r.set(this.data,t,e),this.bot.dispatch("storeChanged",this.data)},t.prototype.get=function(t){return t?r.get(this.data,t):this.data},t.prototype.unset=function(t){var e=this.data;r.unset(e,t),this.data=e,this.bot.dispatch("storeChanged",this.data)},t.prototype.reset=function(){this.data={currentIdx:0,waitingForAnswer:!1,output:{}}},t.prototype.replace=function(t){this.reset(),this.data=r.merge({},this.data,t)},t}();e.Store=i},function(t,e,n){"use strict";function r(t,e,n,r){return a(this,void 0,void 0,function(){var i,o,s,u,a;return c(this,function(c){return i=e.validators||[],o=n.types[e.type].executors||[{}],s=o[r]||{},u=[].concat(0===r?i:[],s.validators||[]),a=l.ensureArray(t),u.forEach(function(t){Object.keys(t).forEach(function(r){var i=n.validators[r];if(i&&"warning"!==r){var o=t[r];if(!a.every(function(t){return i.validate(o,t,e,n)})){var s=t.warning||i.warning,u="function"==typeof s?s(o):s;throw new f.ValidatorError(u,e)}}})}),[2,t]})})}function i(t,e){var n=t.store.output(),r=t.controller.getIndexes(),i=/(?!\{)\w+[.]((?:\w+[.])*\w+)(?=\})/g,o=(e.match(i)||[]).map(function(t){return t.split(".")[0]});return Array.from(new Set(o)).map(function(e){var i=t.rules[r[e]];if(i&&i.options){var o=n[e];n[e]=function(){if(o instanceof Array)return o.map(function(t){var e=l.findOptionByAnswer(i.options,t);return e.toString=function(){return t},e});var t=l.findOptionByAnswer(i.options,o);return t.toString=function(){return o},t}()}}),l.compileTemplate(e,n).trim()}function o(t,e,n){var r=this,i=e[n]||[];return Promise.all(i.map(function(n){return a(r,void 0,void 0,function(){var r=this;return c(this,function(i){return[2,Promise.all(Object.keys(n).map(function(i){return a(r,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return i in t.actions?[4,t.actions[i](n[i],e,t)]:[3,2];case 1:return[2,r.sent()];case 2:return[2,null]}})})}))]})})}))}function s(t,e){if(t.options&&e){var n=l.findOptionByAnswer(t.options,e);if(n&&n.next)return n.next}return t.next?t.next:null}function u(t,e){var n=t.rules[e]?t.rules[e]:{exit:!0};return Object.assign({},t.options.rule,n)}var a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,u)}a((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,o=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){a.label=n[1];break}if(6===n[0]&&a.label<s[1]){a.label=s[1],s=n;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(n);break}s[2]&&a.ops.pop(),a.trys.pop();continue}n=e.call(t,a)}catch(t){n=[6,t],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u};Object.defineProperty(e,"__esModule",{value:!0});var f=n(2),l=n(3),h=function(){function t(t){this.bot=t,this.indexes={},this.reindex()}return t.prototype.reindex=function(){var t=this;this.bot.rules.forEach(function(e,n){e.name&&(t.indexes[e.name]=n)})},t.prototype.getIndexes=function(){return this.indexes},t.prototype.run=function(t){return void 0===t&&(t=0),a(this,void 0,void 0,function(){var e,n;return c(this,function(r){switch(r.label){case 0:return e=this.bot,n=u(e,t),e.store.set("currentIdx",t),e.options.enableWaitForSleep&&"sleep"in n?[4,e.actions.timeout(n.sleep)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,o(e,n,"preActions")];case 3:return r.sent(),n.message?[4,this.sendMessage(n.message,n)]:[3,5];case 4:r.sent(),r.label=5;case 5:return n.exit?(e.end(),[2,this]):[4,o(e,n,"actions")];case 6:if(r.sent(),!n.type)return[2,this.nextRule(n)];if(!e.types[n.type])throw new f.InvalidAttributeError("type",n);return e.store.set("waitingForAnswer",!0),e.dispatch("hear"),[2,this]}})})},t.prototype.sendMessage=function(t,e){return a(this,void 0,void 0,function(){var n,r;return c(this,function(o){switch(o.label){case 0:return n=this.bot,n.dispatch("typing"),!n.options.enableWaitForSleep||e.exit?[3,4]:"delay"in e?[4,n.actions.timeout(e.delay)]:[3,2];case 1:return o.sent(),[3,4];case 2:return[4,n.actions.timeout(l.calculateDelayToTypeMessage(t))];case 3:o.sent(),o.label=4;case 4:return r=i(n,t),n.dispatch("talk",r,e),n.dispatch("typed"),[2,this]}})})},t.prototype.getRuleExecutorIndex=function(t){return this.bot.store.get("executors."+t.name+".currentIdx")||0},t.prototype.setRuleExecutorIndex=function(t,e){void 0!==e?this.bot.store.set("executors."+t.name+".currentIdx",e):this.bot.store.unset("executors."+t.name+".currentIdx")},t.prototype.receiveMessage=function(t){return a(this,void 0,void 0,function(){var e,n,i,o,s,a,l,h,p,d,v,y=this;return c(this,function(c){switch(c.label){case 0:if(e=this.bot,n=e.store.get("currentIdx"),i=u(e,n),!e.store.get("waitingForAnswer"))return[2,this];s=e.types[i.type].executors,a=s[this.getRuleExecutorIndex(i)]||{},l=a.transform,h=void 0===l?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.resolve(t[0])}:l,c.label=1;case 1:return c.trys.push([1,3,,6]),[4,h(t,i,e).then(function(t){return r(t,i,e,y.getRuleExecutorIndex(i))})];case 2:return o=c.sent(),this.getRuleExecutorIndex(i)<s.length-1?(this.setRuleExecutorIndex(i,this.getRuleExecutorIndex(i)+1),e.dispatch("hear"),[2,this]):(this.setRuleExecutorIndex(i),[3,6]);case 3:return p=c.sent(),p instanceof f.ValidatorError?[4,this.sendMessage(p.message,i)]:[3,5];case 4:return c.sent(),e.dispatch("hear"),[2,this];case 5:throw p;case 6:return e.store.set("waitingForAnswer",!1),(d=i.output||i.name,d&&e.store.set("output."+d,o),i.replyMessage)?(v=Object.assign({},e.options.rule),[4,this.sendMessage(i.replyMessage,v)]):[3,8];case 7:c.sent(),c.label=8;case 8:return[2,this.nextRule(i,o)]}})})},t.prototype.jumpByName=function(t){var e=this.indexes[t];if("number"!=typeof e)throw new f.RuleNotFound(t,this.indexes);return this.run(e)},t.prototype.nextRule=function(t,e){var n=this.bot,r=s(t,e);if(r)this.jumpByName(r);else{var i=n.store.get("currentIdx")+1;this.run(i)}return this},t}();e.Controller=h},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o={timeout:function(t){return new Promise(function(e){return setTimeout(e,t)})}},s=function(t){function e(){var e=t.call(this)||this;return e.define(o),e}return r(e,t),e}(i.DefineModule);e.Actions=s},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,u)}a((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,o=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(s=a.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){a.label=n[1];break}if(6===n[0]&&a.label<s[1]){a.label=s[1],s=n;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(n);break}s[2]&&a.ops.pop(),a.trys.pop();continue}n=e.call(t,a)}catch(t){n=[6,t],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,u,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return u={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},s=this;Object.defineProperty(e,"__esModule",{value:!0});var u=n(0),a=n(1),c=n(3),f={Any:{executors:[{}]},String:{executors:[{transform:function(t){return i(s,void 0,void 0,function(){return o(this,function(e){return[2,String(t)]})})},validators:[{string:!0,warning:"Invalid string"}]}]},Number:{executors:[{transform:function(t){return i(s,void 0,void 0,function(){return o(this,function(e){return[2,Number(t)]})})},validators:[{number:!0,warning:"Invalid number"}]}]},SingleChoice:{executors:[{transform:function(t,e){return i(s,void 0,void 0,function(){var n;return o(this,function(r){return n=c.findOptionByAnswer(e.options,t),n?[2,n.value||n.label]:[2,void 0]})})},validators:[{function:function(t,e){return!!c.findOptionByAnswer(e.options,t)},warning:"Unknown option"}]}]},MultipleChoice:{executors:[{transform:function(t,e){return i(s,void 0,void 0,function(){var n,r;return o(this,function(i){return t instanceof Array?n=t:(r=e.options.map(function(t){return String(t.value||t.label)}),n=c.identifyAnswersInString(String(t),r)),[2,u.uniq(n.map(function(t){var n=c.findOptionByAnswer(e.options,t);if(n)return n.value||n.label}).filter(function(t){return t}))]})})},validators:[{function:function(t,e){var n=c.ensureArray(t),r=e.options.map(function(t){return String(t.value||t.label)});return n.every(function(t){return r.some(function(e){return c.isMatchAnswer(t,e)})})},warning:"Unknown options"}]}]}},l=function(t){function e(){var e=t.call(this)||this;return e.define(f),e}return r(e,t),e}(a.DefineModule);e.Types=l},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=function(t){return/^\d+$/.test(t)},s=function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},u=function(t){return o(t)?Number(t):t.length},a={required:{validate:function(t,e){return Boolean((e||"").trim())===t},warning:"This is required"},email:{validate:function(t,e){return s(e)===t},warning:"Invalid email format"},regex:{validate:function(t,e){return new RegExp(t).test(e)},warning:"Invalid answer format"},minWords:{validate:function(t,e){return e.split(" ").length>=t},warning:function(t){return"This answer must have at least "+t+" words"}},maxWords:{validate:function(t,e){return e.split(" ").length<=t},warning:function(t){return"This answer must have a maximum "+t+" words"}},min:{validate:function(t,e){return u(e)>=t},warning:function(t){return"This answer length must be min "+t}},max:{validate:function(t,e){return u(e)<=t},warning:function(t){return"This answer length must be max "+t}},lenght:{validate:function(t,e){return u(e)===t},warning:function(t){return"It must have lenght "+t}},string:{validate:function(t,e){return Boolean(!o(e)&&"string"==typeof e)===t},warning:"It must be a string"},number:{validate:function(t,e){return o(e)===t},warning:"It must be a number"},function:{validate:function(t,e,n,r){return t(e,n,r)},warning:"Error on execute a validator function"}},c=function(t){function e(){var e=t.call(this)||this;return e.define(a),e}return r(e,t),e}(i.DefineModule);e.Validators=c}]);